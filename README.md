# SOXSS
XSS comand and control with websockets

## Reqirements
* Python 3.10 or higher

## Installation

1. Clone the repository: ``git clone https://github.com/ctpache/SOXSS.git``
2. Install the requirements: ``pip install -r requirements.txt``
3. Run the server: ``python3 Soxxs.py``

## Usage

The application has 3 main components:
1. The server, which is the main component of the application. It is responsible for handling the websocket connections, and for serving the payloads to the clients.
2. The console, which is used to interact with the server. It is responsible for sending commands to the clients, and for receiving the output of the commands. It is also responsible for managing the clients that are connected to the server.
3. The payload, which is the code that is executed on the client's browser. It is responsible for establishing the websocket connection with the server, and for executing the commands that are sent by the server. It is also responsible for sending the output of the commands to the server.

There is also a 4th component, which is the MITM server. It uses the client to redirect the traffic to the server with fetch calls. It uses the client's cookies so it can be used as a session stealer. It is not required to use the application, but it is recommended to use it if you want to use the application in a real world scenario.

### Server
The server component serves both HTTP and websockets. The main point of the HTTP server is to get the payload, that will be served on /websocket.js.
The websocket connection will be handled by the payload and the server will only store the connection in a dictionary, with the connection id as the key. The connection id is used to identify the client that sent the command, and to send the output of the command to the correct client. All messages between server and client are encrypted with AES by default, with random keys generated by the server. The client's keys are sent on the payload.

### Console
![console](/docs/Terminal_Web.png)
The console is a simple dashboard with a list of connections and a terminal. The list of connections is updated in real time when a new connection is established or when a connection is closed. The terminal is used to send commands to the clients. The terminal has a few special commands that are used to interact with the server and the clients. The commands are listed below:
* ``list`` - List all the connected clients
* ``change <id>`` - Select a client to send commands to. The id is the connection id that is displayed in the list of connections.
* ``load <filename>`` - Loads a file from the server as a ``<script>`` tag.
* ``downloadFile <localFile> <filename>`` - Downloads a file on the client's machine. The file is sent as a base64 string, and it is decoded on the client's side. The file is saved on the client's machine with the name that is specified in the command.
* ``screenshot`` - Takes a screenshot of the client's current page.
* ``mitm`` - Starts a man in the middle connection (details bellow).
* ``exit`` - Closes the connection with the selected client.

Any other command will be sent to the client to execute as javascript code.

### Payload

The payload has a list of commands that, when recived in a message, will execute. By default, it loads 3 commands:
* ``eval`` - Execute whatever the content of the message is as javascript code. This is the default command, and it is used when no command is specified in the message.
* ``load`` - Loads a script from the server. The script is loaded as a ``<script>`` tag in the head of the document, and it is executed in the global scope.
* ``OK`` - Sends a message to the server to confirm that the connection is established. This is used to check if the connection is still alive, and to check if the client is still connected to the server.

Other commands that must be loaded are:
* ``screenshot`` - Necessary to take screenshots of the client's current page. It uses the ``html2canvas`` library to take the screenshot, and it sends the screenshot as a base64 string to the server. The screenshot is saved on the server's side with the name ``screenshot_<connection_id><timestamp>.png``.
* ``logger`` - ataches an event to any input field on the page, and sends the value of the input field to the server when it is changed. This is used to steal credentials. The data is sent as a json string, with the name of the input field as the key, and the value of the input field as the value. The data is sent to the server with the command ``logger``. The data is saved on the server's side with the name ``logger_<connection_id>.log``.
* ``link2fetch`` - Replaces all the links on the page with fetch calls to the server. This is used to bypass CSP and XFO protections. The links are replaced with a ``<a>`` tag that has an ``onclick`` event that sends a fetch request to the server with the url of the link as a parameter, then rewrites the current document with the data from the fetch call and adds it to the history so the URL displayed on the browser is the same as the original link, making it seamless to the victim. Very useful to gain persistance on the tab.
* ``downloadFile`` - Necessary to download files from the server.
* ``mitm`` - Necessary to use the MITM.
